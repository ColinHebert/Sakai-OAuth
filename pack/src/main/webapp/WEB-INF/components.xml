<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

	<!-- Add our HBM files to the Sakai global session factory -->
	<bean
		class="org.sakaiproject.springframework.orm.hibernate.impl.AdditionalHibernateMappingsImpl">
		<property name="mappingResources">
			<list>
				<value>uk/ac/ox/oucs/vle/StoredTokens.hbm.xml</value>
			</list>
		</property>
	</bean>

	<bean id="uk.ac.ox.oucs.vle.OAuthProvider" class="uk.ac.ox.oucs.vle.OAuthProviderImpl"
		init-method="init">
		<property name="serverConfig"
			ref="org.sakaiproject.component.api.ServerConfigurationService" />
		<property name="store" ref="uk.ac.ox.oucs.vle.HibernateStoreTokens"/>
		<property name="validator">
			<bean class="net.oauth.SimpleOAuthValidator"/>
		</property>
	</bean>

	<bean id="uk.ac.ox.oucs.vle.HibernateStoreTokens"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager">
			<ref
				bean="org.sakaiproject.springframework.orm.hibernate.GlobalTransactionManager" />
		</property>
		<property name="target">
			<bean class="uk.ac.ox.oucs.vle.HibernateStoreTokens">
				<property name="sessionFactory"
					ref="org.sakaiproject.springframework.orm.hibernate.GlobalSessionFactory" />
			</bean>
		</property>
		<property name="transactionAttributes">
			<props>
				<prop key="*">PROPAGATION_REQUIRED</prop>
			</props>
		</property>
	</bean>

</beans>
